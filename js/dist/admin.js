(()=>{var t={n:a=>{var s=a&&a.__esModule?()=>a.default:()=>a;return t.d(s,{a:s}),s},d:(a,s)=>{for(var e in s)t.o(s,e)&&!t.o(a,e)&&Object.defineProperty(a,e,{enumerable:!0,get:s[e]})},o:(t,a)=>Object.prototype.hasOwnProperty.call(t,a),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},a={};(()=>{"use strict";t.r(a),t.d(a,{extend:()=>A});const s=flarum.reg.get("core","admin/app");var e=t.n(s);const n=flarum.reg.get("core","common/extenders");var i=t.n(n);const o=flarum.reg.get("core","common/Model");var r=t.n(o);class l extends(r()){ip(){return r().attribute("ip").call(this)}email(){return r().attribute("email").call(this)}username(){return r().attribute("username").call(this)}sfsData(){return r().attribute("sfsData").call(this)}provider(){return r().attribute("provider").call(this)}providerData(){return r().attribute("providerData").call(this)}attemptedAt(){return r().attribute("attemptedAt",r().transformDate).call(this)}}flarum.reg.add("fof-anti-spam","common/models/BlockedRegistration",l);const d=[(new(i().Store)).add("blocked-registrations",l)];function p(t){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(t)}function c(t,a,s){return(a=function(t){var a=function(t){if("object"!=p(t)||!t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var s=a.call(t,"string");if("object"!=p(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==p(a)?a:a+""}(a))in t?Object.defineProperty(t,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[a]=s,t}const f=flarum.reg.get("core","common/components/Form");var g=t.n(f);const u=flarum.reg.get("core","admin/components/ExtensionPage");var b=t.n(u);const h=flarum.reg.get("core","common/components/Button");var _=t.n(h);const k=flarum.reg.get("core","common/components/Link");var v=t.n(k);const y=flarum.reg.get("core","common/components/LoadingIndicator");var S=t.n(y);const N=flarum.reg.get("core","common/utils/ItemList");var R=t.n(N);const B=flarum.reg.get("core","common/helpers/fullTime");var P=t.n(B);const w=flarum.reg.get("core","common/components/IPAddress");var x=t.n(w);class C extends(b()){constructor(){super(...arguments),c(this,"page",void 0),c(this,"blockedLoading",!1),c(this,"blockedRegistrations",null),c(this,"currentPage",1),c(this,"totalPages",1)}oninit(t){super.oninit(t),this.page="settings"}content(){return m("div",{className:"FoFAntiSpamSettings"},m("div",{className:"container"},this.menuButtons(),"settings"===this.page&&this.settingsContent(),"blocked-registrations"===this.page&&this.blockedRegistrationsContent()))}menuButtons(){return m("div",{className:"MenuButtons"},m(_(),{className:"Button ".concat("settings"===this.page?"active":""),icon:"fas fa-cog",onclick:()=>this.setPage("settings")},e().translator.trans("fof-anti-spam.admin.settings.button")),m(_(),{className:"Button ".concat("blocked-registrations"===this.page?"active":""),icon:"fas fa-ban",onclick:()=>this.setPage("blocked-registrations")},e().translator.trans("fof-anti-spam.admin.blocked_registrations.button")))}setPage(t){this.page=t,"blocked-registrations"!==t||this.blockedRegistrations?m.redraw():this.loadData()}settingsContent(){const t=e().initializers.has("flarum-tags");return m("div",{className:"FoFAntiSpamSettings--settings"},m(g(),null,m("div",{className:"Section Section--defaultActions"},m("h3",null,e().translator.trans("fof-anti-spam.admin.settings.default-actions.heading")),m("p",{className:"helpText"},e().translator.trans("fof-anti-spam.admin.settings.default-actions.introduction")),this.buildSettingComponent({type:"boolean",setting:"fof-anti-spam.actions.deleteUser",label:e().translator.trans("fof-anti-spam.admin.settings.default-actions.delete_user_label"),help:e().translator.trans("fof-anti-spam.admin.settings.default-actions.delete_user_help")}),this.buildSettingComponent({type:"boolean",setting:"fof-anti-spam.actions.deletePosts",label:e().translator.trans("fof-anti-spam.admin.settings.default-actions.delete_posts_label"),help:e().translator.trans("fof-anti-spam.admin.settings.default-actions.delete_posts_help")}),this.buildSettingComponent({type:"boolean",setting:"fof-anti-spam.actions.deleteDiscussions",label:e().translator.trans("fof-anti-spam.admin.settings.default-actions.delete_discussions_label"),help:e().translator.trans("fof-anti-spam.admin.settings.default-actions.delete_discussions_help")}),t&&this.buildSettingComponent({type:"flarum-tags.select-tags",setting:"fof-anti-spam.actions.moveDiscussionsToTags",label:e().translator.trans("fof-anti-spam.admin.settings.default-actions.move_discussions_to_tags_label"),help:e().translator.trans("fof-anti-spam.admin.settings.default-actions.move_discussions_to_tags_help"),options:{requireParentTag:!0,limits:{max:{primary:1},min:{primary:1}}}})),m("div",{className:"Section Section--stopforumspam"},m("h3",null,"StopForumSpam"),m("div",{className:"Introduction"},m("p",{className:"helpText"},e().translator.trans("fof-anti-spam.admin.settings.stopforumspam.introduction",{a:m(v(),{href:"https://stopforumspam.com",target:"_blank",external:!0})}))),this.buildSettingComponent({type:"select",setting:"fof-anti-spam.regionalEndpoint",options:["closest","europe","us"].reduce((t,a)=>(t[a]=e().translator.trans("fof-anti-spam.admin.settings.stopforumspam.region_".concat(a,"_label")),t),{}),label:e().translator.trans("fof-anti-spam.admin.settings.stopforumspam.regional_endpoint_label"),help:e().translator.trans("fof-anti-spam.admin.settings.stopforumspam.regional_endpoint_help"),default:"closest"}),this.buildSettingComponent({type:"boolean",setting:"fof-anti-spam.sfs-lookup",label:e().translator.trans("fof-anti-spam.admin.settings.stopforumspam.sfs_lookup_label"),help:e().translator.trans("fof-anti-spam.admin.settings.stopforumspam.sfs_lookup_help")}),this.buildSettingComponent({type:"boolean",setting:"fof-anti-spam.report_blocked_registrations",label:e().translator.trans("fof-anti-spam.admin.settings.stopforumspam.report_blocked_registrations_label"),help:e().translator.trans("fof-anti-spam.admin.settings.stopforumspam.report_blocked_registrations_help")}),this.buildSettingComponent({type:"boolean",setting:"fof-anti-spam.username",label:e().translator.trans("fof-anti-spam.admin.settings.stopforumspam.username_label")}),this.buildSettingComponent({type:"boolean",setting:"fof-anti-spam.ip",label:e().translator.trans("fof-anti-spam.admin.settings.stopforumspam.ip_label")}),this.buildSettingComponent({type:"boolean",setting:"fof-anti-spam.email",label:e().translator.trans("fof-anti-spam.admin.settings.stopforumspam.email_label")}),this.buildSettingComponent({type:"boolean",setting:"fof-anti-spam.emailhash",label:e().translator.trans("fof-anti-spam.admin.settings.stopforumspam.email_hash_label"),help:e().translator.trans("fof-anti-spam.admin.settings.stopforumspam.email_hash_help")}),this.buildSettingComponent({type:"boolean",setting:"fof-anti-spam.blockTorExitNodes",label:e().translator.trans("fof-anti-spam.admin.settings.stopforumspam.block_tor_exit_nodes_label"),help:e().translator.trans("fof-anti-spam.admin.settings.stopforumspam.block_tor_exit_nodes_help")}),this.buildSettingComponent({type:"number",setting:"fof-anti-spam.frequency",label:e().translator.trans("fof-anti-spam.admin.settings.stopforumspam.frequency_label"),help:e().translator.trans("fof-anti-spam.admin.settings.stopforumspam.frequency_help"),placeholder:"5",required:!0}),this.buildSettingComponent({type:"number",setting:"fof-anti-spam.confidence",label:e().translator.trans("fof-anti-spam.admin.settings.stopforumspam.confidence_label"),help:e().translator.trans("fof-anti-spam.admin.settings.stopforumspam.confidence_help"),min:0,max:100,placeholder:"50.0",required:!0}),m("p",{className:"helpText"},e().translator.trans("fof-anti-spam.admin.settings.stopforumspam.api_key_text")),this.buildSettingComponent({type:"string",setting:"fof-anti-spam.api_key",label:e().translator.trans("fof-anti-spam.admin.settings.stopforumspam.api_key_label"),help:e().translator.trans("fof-anti-spam.admin.settings.stopforumspam.api_key_instructions_text",{register:m("a",{href:"https://www.stopforumspam.com/forum/register.php"}),key:m("a",{href:"https://www.stopforumspam.com/keys"})})})),m("hr",null),this.submitButton()))}blockedRegistrationsContent(){return m("div",{className:"FoFAntiSpamSettings--blockedRegistrations"},m(g(),null,m("h3",null,e().translator.trans("fof-anti-spam.admin.blocked_registrations.title")),this.blockedLoading&&m(S(),null),!this.blockedLoading&&this.blockedRegistrations&&0===this.blockedRegistrations.length&&m("div",null,m("p",null,e().translator.trans("fof-anti-spam.admin.blocked_registrations.no-records"))),!this.blockedLoading&&this.blockedRegistrations&&this.blockedRegistrations.length>0&&m("div",null,m("p",{className:"helpText"},e().translator.trans("fof-anti-spam.admin.blocked_registrations.help")),m("div",{className:"BlockedRegistrations--list"},this.blockedRegistrations.map(t=>m("div",{className:"BlockedRegistrations--item"},m("div",{className:"BlockedRegistrations-item--details"},this.detailItems(t).toArray()),m("div",{className:"BlockedRegistrations-item--actions"},this.actionItems(t).toArray())))),this.renderPagination())))}async loadData(t){void 0===t&&(t=1),this.blockedLoading=!0,m.redraw();try{const a=await e().store.find("blocked-registrations",{page:{offset:(t-1)*C.ITEMS_PER_PAGE,limit:C.ITEMS_PER_PAGE}});this.blockedRegistrations=a;const s=a.length===C.ITEMS_PER_PAGE;this.totalPages=s?t+1:t}catch(t){console.error(t),this.blockedRegistrations=[]}this.blockedLoading=!1,this.currentPage=t,m.redraw()}renderPagination(){return m("nav",{className:"BlockedRegistrations--pagination"},m(_(),{className:"Button",disabled:this.currentPage<=1,onclick:()=>this.loadData(this.currentPage-1)},"Previous"),m("span",null,"Page ",this.currentPage," of ",this.totalPages),m(_(),{className:"Button",disabled:this.currentPage>=this.totalPages,onclick:()=>this.loadData(this.currentPage+1)},"Next"))}detailItems(t){var a;const s=new(R());return s.add("attemptedAt",m("div",{className:"BlockedRegistrations-item--details"},m("span",{className:"BlockedRegistrations-label"},e().translator.trans("fof-anti-spam.admin.blocked_registrations.attempted-at")),m("span",{className:"BlockedRegistrations-value"},P()(null!=(a=t.attemptedAt())?a:new Date))),100),s.add("ip",m("div",{className:"BlockedRegistrations-item--details"},m("span",{className:"BlockedRegistrations-label"},e().translator.trans("fof-anti-spam.admin.blocked_registrations.ip")),m("span",{className:"BlockedRegistrations-value"},m(x(),{ip:t.ip()}))),90),s.add("email",m("div",{className:"BlockedRegistrations-item--details"},m("span",{className:"BlockedRegistrations-label"},e().translator.trans("fof-anti-spam.admin.blocked_registrations.email")),m("span",{className:"BlockedRegistrations-value"},t.email())),80),s.add("username",m("div",{className:"BlockedRegistrations-item--details"},m("span",{className:"BlockedRegistrations-label"},e().translator.trans("fof-anti-spam.admin.blocked_registrations.username")),m("span",{className:"BlockedRegistrations-value"},t.username())),70),t.provider()&&s.add("provider",m("div",{className:"BlockedRegistrations-item--details"},m("span",{className:"BlockedRegistrations-label"},e().translator.trans("fof-anti-spam.admin.blocked_registrations.login-provider")),m("span",{className:"BlockedRegistrations-value"},m("code",null,t.provider()))),60),t.providerData()&&s.add("providerData",m("div",{className:"BlockedRegistrations-item--details"},m("span",{className:"BlockedRegistrations-label"},e().translator.trans("fof-anti-spam.admin.blocked_registrations.login-provider-data")),m("span",{className:"BlockedRegistrations-value"},m("code",null,t.providerData()))),50),s.add("sfsData",m("div",{className:"BlockedRegistrations-item--details"},m("span",{className:"BlockedRegistrations-label"},e().translator.trans("fof-anti-spam.admin.blocked_registrations.sfs-data")),m("span",{className:"BlockedRegistrations-value"},m("code",null,t.sfsData()))),20),s}actionItems(t){const a=new(R());return a.add("delete",m(_(),{className:"Button Button--danger",icon:"fas fa-trash",onclick:()=>{var a;t.delete(),this.blockedRegistrations=null==(a=this.blockedRegistrations)?void 0:a.filter(a=>a.id()!==t.id()),m.redraw()}},e().translator.trans("fof-anti-spam.admin.blocked_registrations.delete_entry"))),a}}c(C,"ITEMS_PER_PAGE",20),flarum.reg.add("fof-anti-spam","admin/components/AntiSpamSettingsPage",C);const A=[...d,(new(i().Admin)).page(C).permission(()=>({icon:"fas fa-pastafarianism",label:e().translator.trans("fof-anti-spam.admin.permissions.spamblock_users_label"),permission:"user.spamblock"}),"moderate")];e().initializers.add("fof-anti-spam",()=>{})})(),module.exports=a})();
//# sourceMappingURL=admin.js.map